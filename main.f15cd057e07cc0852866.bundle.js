(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1240:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){var _storybook_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(440);module._StorybookPreserveDecorators=!0,Object(_storybook_react__WEBPACK_IMPORTED_MODULE_0__.configure)([__webpack_require__(1264),__webpack_require__(1265)],module)}.call(this,__webpack_require__(1241)(module))},1264:function(module,exports){function webpackEmptyContext(req){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=function(){return[]},webpackEmptyContext.resolve=webpackEmptyContext,module.exports=webpackEmptyContext,webpackEmptyContext.id=1264},1265:function(module,exports,__webpack_require__){var map={"./GettingStarted.stories.mdx":1269};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=1265},1269:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"__page",(function(){return __page}));__webpack_require__(1),__webpack_require__(45),__webpack_require__(39),__webpack_require__(9),__webpack_require__(4),__webpack_require__(1266),__webpack_require__(1267),__webpack_require__(5),__webpack_require__(41);var react=__webpack_require__(0),react_default=__webpack_require__.n(react),esm=__webpack_require__(25),blocks=__webpack_require__(109),styled_components_browser_esm=__webpack_require__(281);const Background=styled_components_browser_esm.a.div`
  display: flex;
  flex-direction: column;
  max-width: 720px;
  margin: 0 auto;
  padding: 1rem;
  font-family: Oswald, sans-serif;

  button {
    width: 120px;
  }
`,Iframe=styled_components_browser_esm.a.iframe`
  height: 240px;
  width: 240px;
  border: 1px solid #FFF;
`;function isWorker(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}function extractMethods(obj){const paths=[];return function parse(obj,path=""){Object.keys(obj).forEach(prop=>{const propPath=path?`${path}.${prop}`:prop;obj[prop]===Object(obj[prop])&&parse(obj[prop],propPath),"function"==typeof obj[prop]&&paths.push(propPath)})}(obj),paths}const urlRegex=/^(https?:|file:)?\/\/([^/:]+)?(:(\d+))?/,ports={"http:":"80","https:":"443"};var events,actions,lodash_get=__webpack_require__(442),lodash_get_default=__webpack_require__.n(lodash_get),lodash_set=__webpack_require__(443),lodash_set_default=__webpack_require__.n(lodash_set),v4=__webpack_require__(1275);function registerLocalMethods(schema={},methods=[],_connectionID,guest){const listeners=[];return methods.forEach(methodName=>{async function handleCall(event){const{action:action,callID:callID,connectionID:connectionID,callName:callName,args:args=[]}=event.data;if(action!==actions.RPC_REQUEST)return;if(!callID||!callName)return;if(callName!==methodName)return;if(connectionID!==_connectionID)return;const payload={action:actions.RPC_RESOLVE,callID:callID,callName:callName,connectionID:connectionID,error:null,result:null};try{const result=await lodash_get_default()(schema,methodName)(...args);payload.result=JSON.parse(JSON.stringify(result))}catch(error){payload.error=JSON.parse(JSON.stringify(error,Object.getOwnPropertyNames(error)))}guest?guest.postMessage(payload):isWorker()?self.postMessage(payload):event.source.postMessage(payload,event.origin)}guest?guest.addEventListener(events.MESSAGE,handleCall):self.addEventListener(events.MESSAGE,handleCall),listeners.push(()=>self.removeEventListener(events.MESSAGE,handleCall))}),()=>listeners.forEach(unregister=>unregister())}function registerRemoteMethods(schema={},methods=[],_connectionID,event,guest){const remote={...schema},listeners=[];return methods.forEach(methodName=>{const rpc=function createRPC(_callName,_connectionID,event,listeners=[],guest){return(...args)=>new Promise((resolve,reject)=>{const callID=Object(v4.a)();function handleResponse(event){const{callID:callID,connectionID:connectionID,callName:callName,result:result,error:error,action:action}=event.data;if(callID&&callName&&callName===_callName&&connectionID===_connectionID)return action===actions.RPC_RESOLVE?resolve(result):action===actions.RPC_REJECT?reject(error):void 0}const payload={action:actions.RPC_REQUEST,args:JSON.parse(JSON.stringify(args)),callID:callID,callName:_callName,connectionID:_connectionID};guest?guest.addEventListener(events.MESSAGE,handleResponse):self.addEventListener(events.MESSAGE,handleResponse),listeners.push(()=>self.removeEventListener(events.MESSAGE,handleResponse)),guest?guest.postMessage(payload):isWorker()?self.postMessage(payload):(event.source||event.target).postMessage(payload,event.origin)})}(methodName,_connectionID,event,listeners,guest);lodash_set_default()(remote,methodName,rpc)}),{remote:remote,unregisterRemote:()=>listeners.forEach(unregister=>unregister())}}!function(events){events.MESSAGE="message"}(events||(events={})),function(actions){actions.HANDSHAKE_REQUEST="RIMLESS/HANDSHAKE_REQUEST",actions.HANDSHAKE_REPLY="RIMLESS/HANDSHAKE_REPLY",actions.RPC_REQUEST="RIMLESS/RPC_REQUEST",actions.RPC_RESOLVE="RIMLESS/RPC_RESOLVE",actions.RPC_REJECT="RIMLESS/RPC_REJECT"}(actions||(actions={}));const connections={};function isValidTarget(iframe,event){const childOrigin=function getOriginFromURL(url){const{location:location}=document,regexResult=urlRegex.exec(url||"");let protocol,hostname,port;return regexResult?[,protocol=location.protocol,hostname,,port]=regexResult:(protocol=location.protocol,hostname=location.hostname,port=location.port),"file:"===protocol?"null":`${protocol}//${hostname}${port&&port!==ports[protocol]?":"+port:""}`}(iframe.getAttribute("src")),hasProperOrigin=event.origin===childOrigin,hasProperSource=event.source===iframe.contentWindow;return hasProperOrigin&&hasProperSource}var host={connect:function host_connect(guest,schema={},options){if(!guest)throw new Error("a target is required");const guestIsWorker=void 0!==guest.onerror&&void 0!==guest.onmessage,listeners=guestIsWorker?guest:window;return new Promise((resolve,reject)=>{const connectionID=Object(v4.a)();listeners.addEventListener(events.MESSAGE,(function handleHandshake(event){if(!guestIsWorker&&!isValidTarget(guest,event))return;if(event.data.action!==actions.HANDSHAKE_REQUEST)return;const localMethods=extractMethods(schema),unregisterLocal=registerLocalMethods(schema,localMethods,connectionID,guestIsWorker?guest:void 0),{remote:remote,unregisterRemote:unregisterRemote}=registerRemoteMethods(event.data.schema,event.data.methods,connectionID,event,guestIsWorker?guest:void 0),payload={action:actions.HANDSHAKE_REPLY,connectionID:connectionID,methods:localMethods,schema:JSON.parse(JSON.stringify(schema))};guestIsWorker?guest.postMessage(payload):event.source.postMessage(payload,event.origin);const connection={remote:remote,close:()=>{listeners.removeEventListener(events.MESSAGE,handleHandshake),unregisterRemote(),unregisterLocal()}};return connections[connectionID]=connection,resolve(connection)}))})}};var examples_SingleIframeExample=function SingleIframeExample(){const iframe=react_default.a.useRef(null),[color,setColor]=react_default.a.useState(null),[connection,setConnection]=react_default.a.useState(null);return react_default.a.useEffect(()=>{iframe.current&&(async()=>{const newConnection=await host.connect(iframe.current,{setColor:setColor});setConnection(newConnection)})()},[iframe.current]),react_default.a.createElement(Background,{style:{background:color}},react_default.a.createElement("div",{style:{flex:1}},react_default.a.createElement("h1",null,"HOST"),react_default.a.createElement("button",{type:"button",onClick:()=>connection.remote.setColor(function makeRandomColor(){let color="#";for(let i=0;i<6;i++)color+="0123456789ABCDEF"[Math.floor(16*Math.random())];return color}())},"call iframe function")),react_default.a.createElement("div",{style:{marginTop:"1rem"}},react_default.a.createElement(Iframe,{title:"guest",ref:iframe,src:"https://au-re.com/rimless/index.html",sandbox:"allow-same-origin allow-scripts"})))};function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _extends(){return(_extends=Object.assign||function(target){for(var source,i=1;i<arguments.length;i++)for(var key in source=arguments[i])Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key]);return target}).apply(this,arguments)}function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],0<=excluded.indexOf(key)||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],0<=excluded.indexOf(key)||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}var layoutProps={},_ref2=Object(esm.mdx)(blocks.Meta,{title:"Getting Started|Overview",mdxType:"Meta"}),_ref3=Object(esm.mdx)("strong",{parentName:"p"},"iframes"),_ref4=Object(esm.mdx)("strong",{parentName:"p"},"webworkers"),_ref5=Object(esm.mdx)("p",null,"You can use ",Object(esm.mdx)("inlineCode",{parentName:"p"},"Rimless")," to call remote procedures, exchange data or expose local functions\nwith ",Object(esm.mdx)("strong",{parentName:"p"},"iframes"),"/",Object(esm.mdx)("strong",{parentName:"p"},"webworkers"),"."),_ref6=Object(esm.mdx)("p",null,"In the example below you can invoke remote procedures from an iframe to the host website and vice\nversa."),_ref7=Object(esm.mdx)(blocks.Preview,{withSource:"none",mdxSource:"%0A%3CSingleIframeExample%20/%3E%0A",mdxType:"Preview"},Object(esm.mdx)(examples_SingleIframeExample,{mdxType:"SingleIframeExample"}));function MDXContent(_ref){var components=_ref.components,props=_objectWithoutProperties(_ref,["components"]);return Object(esm.mdx)("wrapper",_extends({},layoutProps,props,{components:components,mdxType:"MDXLayout"}),_ref2,Object(esm.mdx)("h1",{id:"rimless"},"Rimless"),Object(esm.mdx)("blockquote",null,Object(esm.mdx)("p",{parentName:"blockquote"},"Rimless makes event based communication easy with a promise-based API wrapping ",Object(esm.mdx)("a",_extends({parentName:"p"},{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage",target:"_blank",rel:["nofollow","noopener","noreferrer"]}),"postMessage"),". Works with both ",_ref3," and ",_ref4,".")),_ref5,Object(esm.mdx)("h2",{id:"rpcs-on-iframes"},"RPCs on Iframes"),_ref6,_ref7)}MDXContent.displayName="MDXContent",MDXContent.isMDXComponent=!0;var __page=function(){throw new Error("Docs-only story")};__page.story={parameters:{docsOnly:!0}};var componentMeta={title:"Getting Started|Overview",includeStories:["__page"]};componentMeta.parameters=componentMeta.parameters||{};var _ref8=Object(esm.mdx)(blocks.AddContext,{mdxStoryNameToKey:{},mdxComponentMeta:componentMeta},Object(esm.mdx)(MDXContent,null));componentMeta.parameters.docs=function _objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null!=arguments[i]?arguments[i]:{},i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}));return target}({},componentMeta.parameters.docs||{},{page:function page(){return _ref8}});__webpack_exports__.default=componentMeta},445:function(module,exports,__webpack_require__){__webpack_require__(446),__webpack_require__(588),__webpack_require__(589),__webpack_require__(1239),module.exports=__webpack_require__(1240)},508:function(module,exports){}},[[445,1,2]]]);
//# sourceMappingURL=main.f15cd057e07cc0852866.bundle.js.map